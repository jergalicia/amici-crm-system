{% extends "base.html" %}

{% block content %}
<div class="header">
    <div class="page-title">Crear Nuevo Artículo</div>
    <a href="{{ url_for('articles.index') }}" class="btn-primary"
        style="text-decoration: none; width: auto; display: inline-block; background: var(--gray-800);">Volver</a>
</div>

<div class="card" style="max-width: 800px;">
    <form action="{{ url_for('articles.create') }}" method="post" enctype="multipart/form-data">

        <!-- Admin Override for Author -->
        {% if current_user.role == 'admin' %}
        <div class="form-group">
            <label for="author_id">Autor (Opcional - Admin Override)</label>
            <select name="author_id" id="author_id" class="form-control">
                <option value="">-- Mí mismo --</option>
                {% for user in users %}
                <option value="{{ user.id }}">{{ user.username }} ({{ user.role }})</option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <div class="form-group">
            <label for="edition_id">Edición</label>
            <select name="edition_id" id="edition_id" class="form-control" required>
                {% for edition in editions %}
                <option value="{{ edition.id }}">{{ edition.title }} ({{ edition.publication_date }})</option>
                {% endfor %}
            </select>
            {% if not editions %}
            <small style="color: var(--primary-red);">No hay ediciones activas para tu país.</small>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="title">Título (Max 60 caracteres)</label>
            <input type="text" name="title" id="title" class="form-control" maxlength="60" required
                placeholder="Título impactante...">
        </div>

        <div class="form-group">
            <label for="content">Contenido (Max 600 caracteres)</label>
            <textarea name="content" id="content" class="form-control" rows="6" maxlength="600" required
                placeholder="Escribe el contenido aquí..."></textarea>
            <div style="text-align: right; font-size: 0.8rem; color: var(--text-light); margin-top: 0.25rem;">
                <span id="charCount">0</span>/600
            </div>
        </div>

        <div class="form-group">
            <label for="images">Imágenes (Máximo 5)</label>
            <input type="file" name="images" id="images" class="form-control" accept="image/*" multiple max="5">
            <small style="color: var(--text-light);">Selecciona hasta 5 imágenes (JPG, PNG).</small>
        </div>

        <button type="submit" class="btn-primary" {% if not editions %}disabled
            style="opacity: 0.5; cursor: not-allowed;" {% endif %}>Publicar Artículo</button>
    </form>
</div>

<script>
    const content = document.getElementById('content');
    const charCount = document.getElementById('charCount');

    content.addEventListener('input', function () {
        charCount.textContent = this.value.length;
    });

    // Country/Edition dynamic loading could be added here if admins select country first
</script>
{% endblock %}
